{% extends 'core/base.html' %}
{% block title %}Pedidos{% endblock %}

{% block content %}
<section class="panel">
  <header class="panel__header">
    <div>
      <h2>Pedidos</h2>
      <p>Acompanhe solicitações de compra</p>
    </div>
    <div class="panel__actions">
      <a href="{% url 'novo_pedido' %}" class="btn btn--primary">Novo Pedido</a>
    </div>
  </header>

  <form method="get" class="filter-bar">
    <select name="status">
      <option value="">Todos os status</option>
      {% for value,label in pedidos.model.STATUS_CHOICES %}
        <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>

    <select name="fornecedor">
      <option value="">Todos os fornecedores</option>
      {% for fornecedor in fornecedores %}
        <option value="{{ fornecedor.pk }}" {% if fornecedor_filter == fornecedor.pk|stringformat:'s' %}selected{% endif %}>{{ fornecedor.nome }}</option>
      {% endfor %}
    </select>

    <button type="submit" class="btn">Filtrar</button>
  </form>

  <div class="table-wrapper">
    <table class="table">
      <thead>
        <tr>
          <th>#</th>
          <th>Fornecedor</th>
          <th>Item</th>
          <th>Quantidade</th>
          <th>Status</th>
          <th>Prevista</th>
          <th>Criado em</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for pedido in pedidos %}
        <tr>
          <td>{{ pedido.pk }}</td>
          <td>{{ pedido.fornecedor.nome }}</td>
          <td>{{ pedido.item.nome }}</td>
          <td>{{ pedido.quantidade }}</td>
          <td><span class="status">{{ pedido.get_status_display }}</span></td>
          <td>{{ pedido.entrega_prevista|date:"d/m/Y"|default:"—" }}</td>
          <td>{{ pedido.criado_em|date:"d/m/Y" }}</td>
          <td>
            <div class="table__actions">
              <a href="{% url 'pedido_update' pedido.pk %}">Editar</a>
              <a href="{% url 'pedido_delete' pedido.pk %}">Excluir</a>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="8">Nenhum pedido cadastrado.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
